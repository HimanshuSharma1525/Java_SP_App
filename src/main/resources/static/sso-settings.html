<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSO Settings | miniOrange Integration</title>
    <style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: #ddd; min-height: 100vh; } .navbar { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); } .navbar-brand { font-size: 24px; font-weight: bold; } .btn-back { background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; transition: all 0.3s; } .btn-back:hover { background: white; color: #43e97b; } .container { max-width: 950px; margin: 40px auto; padding: 0 20px; } .settings-card { background: #1a1a1a; padding: 30px; border-radius: 16px; box-shadow: 0 0 30px rgba(0, 255, 224, 0.2); animation: slideIn 0.5s ease-out; } @keyframes slideIn { from { opacity: 0; transform: translateY(-20px);} to { opacity: 1; transform: translateY(0);} } h2 { text-align: center; font-size: 28px; font-weight: 700; color: #00ffe0; margin-bottom: 10px; text-shadow: 0 0 8px #00ffe0; } .subtitle { text-align: center; color: #cbd5e1; margin-bottom: 20px; font-size: 14px; } .note { background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107; padding: 12px 15px; border-radius: 10px; color: #ffecb3; margin-bottom: 20px; font-size: 14px; } .nav-tabs { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; } .nav-tabs .nav-link { padding: 10px 25px; border-radius: 10px; cursor: pointer; font-weight: 500; background: rgba(51,65,85,0.2); color: #cbd5e1; transition: all 0.3s ease; text-align: center; border: none; } .nav-tabs .nav-link.active { background: linear-gradient(135deg, #00ffe0, #00b8b0); color: #0f0f0f; box-shadow: 0 0 15px rgba(0,255,224,0.5); } .form-section { display: none; animation: fadeIn 0.3s ease; } .form-section.active { display: block; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} } .form-group { margin-bottom: 20px; } label { font-weight: 500; font-size: 14px; color: #cbd5e1; display: block; margin-bottom: 8px; } .form-control { width: 100%; padding: 12px; border-radius: 8px; border: none; outline: none; background: rgba(255,255,255,0.08); color: #fff; font-size: 15px; transition: all 0.25s ease; } .form-control::placeholder { color: #94a3b8; } .form-control:focus { background: rgba(255,255,255,0.12); border: 1px solid #00ffe0; box-shadow: 0 0 8px #00ffe0; } textarea.form-control { resize: vertical; min-height: 120px; font-family: 'Courier New', monospace; font-size: 13px; } .form-check { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; } .form-check-input { width: 20px; height: 20px; cursor: pointer; accent-color: #00ffe0; } .form-check-label { color: #fff; font-weight: 500; font-size: 15px; cursor: pointer; } .btn { border: none; border-radius: 10px; padding: 12px 24px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-align: center; font-size: 15px; } .btn-primary { background: linear-gradient(135deg, #00ffe0, #00b8b0); color: #0f0f0f; box-shadow: 0 0 8px rgba(0,255,224,0.4); width: 100%; } .btn-primary:hover { box-shadow: 0 0 15px rgba(0,255,224,0.7); transform: translateY(-2px); } .btn-test { width: 100%; background: linear-gradient(135deg, #ff8c00, #ffb300); color: #0f0f0f; margin-top: 10px; box-shadow: 0 0 8px rgba(255,140,0,0.3); } .btn-test:hover { box-shadow: 0 0 15px rgba(255,140,0,0.6); transform: translateY(-2px); } .alert { padding: 12px 16px; border-radius: 8px; margin-top: 20px; display: none; } .alert-success { background: rgba(0,255,127,0.1); border-left: 5px solid #00e676; color: #a7f3d0; } .alert-error { background: rgba(255,82,82,0.1); border-left: 5px solid #ff5252; color: #ffcdd2; } .small-text { font-size: 12px; color: #94a3b8; margin-top: 5px; } </style>
</head>
<body>
<nav class="navbar">
    <div class="navbar-brand">üîê SSO Configuration</div>
    <a href="/customer-admin-dashboard.html" class="btn-back">‚Üê Back to Dashboard</a>
</nav>

<div class="container">
    <div class="settings-card">
        <h2>miniOrange SSO Integration</h2>
        <p class="subtitle">Configure Single Sign-On for your organization</p>

        <div class="note">
            <strong>Note:</strong> Choose one protocol (JWT, SAML, or OAuth) and configure its settings. Our app acts as Service Provider (SP) and miniOrange as Identity Provider (IdP).
        </div>

        <!-- Tabs -->
        <div class="nav-tabs">
            <button class="nav-link active" data-section="jwt">JWT</button>
            <button class="nav-link" data-section="saml">SAML</button>
            <button class="nav-link" data-section="oauth">OAuth</button>
        </div>

        <!-- JWT Section -->
        <div id="jwt" class="form-section active">
            <form id="jwtForm">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="jwtEnabled" name="enabled">
                    <label class="form-check-label" for="jwtEnabled">Enable JWT Login</label>
                </div>

                <div class="form-group">
                    <label for="jwtUrl">JWT Login URL *</label>
                    <input type="text" class="form-control" id="jwtUrl" name="jwtUrl" placeholder="https://login.xecurify.com/moas/jwt/login" required>
                </div>

                <div class="form-group">
                    <label for="jwtIssuer">JWT Issuer *</label>
                    <input type="text" class="form-control" id="jwtIssuer" name="jwtIssuer" placeholder="miniOrange" required>
                </div>


                <div class="form-group">
                    <label for="jwtSecret">JWT Secret (HS256)</label>
                    <input type="password" class="form-control" id="jwtSecret" name="jwtSecret" placeholder="Enter JWT Secret Key">
                </div>

                <div class="form-group">
                    <label for="jwtCertificate">JWT Certificate (RS256)</label>
                    <textarea class="form-control" id="jwtCertificate" name="jwtCertificate" placeholder="-----BEGIN CERTIFICATE-----&#10;...&#10;-----END CERTIFICATE-----"></textarea>
                </div>

                <button type="button" class="btn btn-test" onclick="testJWT()">üß™ Test JWT Login</button>
                <button type="submit" class="btn btn-primary">üíæ Save JWT Configuration</button>
            </form>
        </div>

        <!-- SAML Section -->
        <div id="saml" class="form-section">
            <form id="samlForm">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="samlEnabled" name="enabled">
                    <label class="form-check-label" for="samlEnabled">Enable SAML Login</label>
                </div>

                <div class="form-group">
                    <label for="samlSsoUrl">SAML SSO URL *</label>
                    <input type="text" class="form-control" id="samlSsoUrl" name="samlSsoUrl" placeholder="https://login.xecurify.com/moas/idp/samlsso" required>
                </div>

                <div class="form-group">
                    <label for="idpEntityId">IdP Entity ID *</label>
                    <input type="text" class="form-control" id="idpEntityId" name="idpEntityId" placeholder="https://login.xecurify.com/moas/idp/saml" required>
                </div>

                <div class="form-group">
                    <label for="samlSpEntityId">SP Entity ID *</label>
                    <input type="text" class="form-control" id="samlSpEntityId" name="samlSpEntityId" placeholder="http://localhost:8080/sso/saml/metadata" required>
                </div>

                <div class="form-group">
                    <label for="samlAcsUrl">Assertion Consumer Service URL *</label>
                    <input type="text" class="form-control" id="samlAcsUrl" name="samlAcsUrl" placeholder="http://localhost:8080/sso/saml/callback" required>
                </div>

                <div class="form-group">
                    <label for="samlCertificate">IdP X.509 Certificate *</label>
                    <textarea class="form-control" id="samlCertificate" name="samlCertificate" placeholder="-----BEGIN CERTIFICATE-----&#10;...&#10;-----END CERTIFICATE-----" required></textarea>
                </div>

                <button type="button" class="btn btn-test" onclick="testSAML()">üß™ Test SAML SSO</button>
                <button type="submit" class="btn btn-primary">üíæ Save SAML Configuration</button>
            </form>
        </div>

        <!-- OAuth Section -->
        <div id="oauth" class="form-section">
            <form id="oauthForm">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="oauthEnabled" name="enabled">
                    <label class="form-check-label" for="oauthEnabled">Enable OAuth Login</label>
                </div>

                <div class="form-group">
                    <label for="oauthAuthorizationUrl">Authorization URL *</label>
                    <input type="text" class="form-control" id="oauthAuthorizationUrl" name="oauthAuthorizationUrl" placeholder="https://login.xecurify.com/moas/idp/oauth/authorize" required>
                </div>

                <div class="form-group">
                    <label for="oauthTokenUrl">Token URL *</label>
                    <input type="text" class="form-control" id="oauthTokenUrl" name="oauthTokenUrl" placeholder="https://login.xecurify.com/moas/idp/oauth/token" required>
                </div>

                <div class="form-group">
                    <label for="oauthUserInfoUrl">User Info URL *</label>
                    <input type="text" class="form-control" id="oauthUserInfoUrl" name="oauthUserInfoUrl" placeholder="https://login.xecurify.com/moas/idp/userinfo" required>
                </div>

                <div class="form-group">
                    <label for="oauthClientId">Client ID *</label>
                    <input type="text" class="form-control" id="oauthClientId" name="oauthClientId" placeholder="your-client-id" required>
                </div>

                <div class="form-group">
                    <label for="oauthClientSecret">Client Secret *</label>
                    <input type="password" class="form-control" id="oauthClientSecret" name="oauthClientSecret" placeholder="your-client-secret" required>
                </div>

                <div class="form-group">
                    <label for="oauthRedirectUri">Redirect URI *</label>
                    <input type="text" class="form-control" id="oauthRedirectUri" name="oauthRedirectUri" placeholder="http://localhost:8080/sso/oauth/callback" required>
                </div>

                <div class="form-group">
                    <label for="oauthScopes">Scopes</label>
                    <input type="text" class="form-control" id="oauthScopes" name="oauthScopes" placeholder="openid,profile,email" value="openid,profile,email">
                </div>

                <button type="button" class="btn btn-test" onclick="testOAuth()">üß™ Test OAuth Login</button>
                <button type="submit" class="btn btn-primary">üíæ Save OAuth Configuration</button>
            </form>
        </div>

        <div id="alertContainer"></div>
    </div>
</div>

<script>
    const token = localStorage.getItem('authToken');
    if (!token) window.location.href = '/login.html';

    // Tab switching
    document.querySelectorAll('.nav-link').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.nav-link').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            document.getElementById(this.dataset.section).classList.add('active');
        });
    });

    async function loadSSOConfig() {
        try {
            const res = await fetch('/api/sso/config', { headers: { 'Authorization': `Bearer ${token}` } });
            if (res.ok) {
                const configs = await res.json();
                configs.forEach(populateForm);
            }
        } catch (err) { console.error(err); }
    }

    function populateForm(config) {
        const form = document.getElementById(`${config.provider.toLowerCase()}Form`);
        if (!form) return;
        Object.keys(config).forEach(key => {
            const input = form.querySelector(`[name="${key}"]`);
            if (input) {
                input.type === 'checkbox' ? input.checked = config[key] : input.value = config[key] || '';
            }
        });
    }

    // Form submit handlers
    ['jwtForm','samlForm','oauthForm'].forEach(id => {
        document.getElementById(id).addEventListener('submit', async e => {
            e.preventDefault();
            const provider = id.replace('Form','').toUpperCase();
            const data = { provider };
            new FormData(e.target).forEach((v,k)=> data[k]=k==='enabled'? v==='on':v);
            try {
                const res = await fetch('/api/sso/config', {
                    method:'POST',
                    headers:{'Authorization':`Bearer ${token}`, 'Content-Type':'application/json'},
                    body: JSON.stringify(data)
                });
                if(res.ok) showAlert(`${provider} configuration saved!`,'success');
                else { const err = await res.json(); showAlert(err.error || 'Save failed','error'); }
            } catch(e){ showAlert('Network error','error'); }
        });
    });

    function testJWT(){ window.open('/sso/jwt/login','_blank'); }
    function testSAML(){ window.open('/sso/saml/login','_blank'); }
    function testOAuth(){ window.open('/sso/oauth/login','_blank'); }

    function showAlert(msg,type){
        const c = document.getElementById('alertContainer');
        c.innerHTML=`<div class="alert ${type==='success'?'alert-success':'alert-error'}">${msg}</div>`;
        const a=c.querySelector('.alert'); a.style.display='block';
        setTimeout(()=>a.style.display='none',5000);
    }

    loadSSOConfig();
</script>
</body>
</html>
